{
  "hash": "e77d07da56716f9c8133fe6def95b03f",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"A small review of univariate parametric statistics\"\nauthor:\n  - name: Marguerite Butler\n    url: https://butlerlab.org\n    affiliation: School of Life Sciences, University of Hawaii\n    affiliation_url: https://manoa.hawaii.edu/lifesciences/\ndescription: \"Add\"\ndate: 2025-03-06\ncategories: [module 4, week 7, univariate, statistics, ggplot2, dplyr]\n---\n\n\n\n# Learning objectives\n\n::: callout-note\n# Learning objectives\n\n**At the end of this lesson you will:**\n\n-   Be able to perform basic univariate statistics\n-   Be able to design plots to display univariate comparisons\n-   Be able to relate questions to graphical representations of data\n:::\n\n# Overview\n\nA small review of the linear regression and ANOVA\n\n\n# Tiny review of Univariate statistics\n\n## Linear Regression\n\nLinear regression asks whether there is a relationship between X and Y, that is if you know X can you predict the value of Y?\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwith(iris, plot(Sepal.Width ~ Sepal.Length))\nlm.fit <- with(iris, lm(Sepal.Width ~ Sepal.Length))\nabline(lm.fit, col=\"blue\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-1-1.png){width=672}\n:::\n:::\n\n\n\nLinear regression results in two parameters, the best-fit slope and intercept:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlm.fit \n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nlm(formula = Sepal.Width ~ Sepal.Length)\n\nCoefficients:\n (Intercept)  Sepal.Length  \n     3.41895      -0.06188  \n```\n\n\n:::\n\n```{.r .cell-code}\nsummary(lm.fit)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nlm(formula = Sepal.Width ~ Sepal.Length)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-1.1095 -0.2454 -0.0167  0.2763  1.3338 \n\nCoefficients:\n             Estimate Std. Error t value Pr(>|t|)    \n(Intercept)   3.41895    0.25356   13.48   <2e-16 ***\nSepal.Length -0.06188    0.04297   -1.44    0.152    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 0.4343 on 148 degrees of freedom\nMultiple R-squared:  0.01382,\tAdjusted R-squared:  0.007159 \nF-statistic: 2.074 on 1 and 148 DF,  p-value: 0.1519\n```\n\n\n:::\n:::\n\n\n\nRegression minimizes the __sum of squared errors__ (or deviations) from the line. The \"errors\" are the difference between where Y is, and where Y should be if it followed a perfect line. \n\nWe can illustrate what this means:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nx <- iris$Sepal.Length\ny <- iris$Sepal.Width\nyhat <- predict(lm.fit)\n\nwith(iris, plot(Sepal.Width ~ Sepal.Length))\nwith(iris, abline(lm.fit, col=\"blue\"))\nfor(i in 1:length(x))  lines(x[c(i,i)],c(y[i], yhat[i]), col=\"red\", lty=2)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n\n\nThe regression line is the best fit line that minimizes the sums of squared deviations from the regression. It turns out that the least-squares fit of the regression line is also provides the Maximum Likelihood fits of the parameters of the line (the slope and intercept).\n\n## ANOVA\n\nAnalysis of variance is very closely related to regression. It also works by minimizing sums of squares, but it asks a different question. \n\nDoes the data better fit a model with one group (one regression line?) or multiple groups (multiple regression lines, one for each group)?\n\nGraphically, it looks like the plot below with the question _Is the data explained better by a single group with a grand mean? or with separate means for each_ `Species`? \n \n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npar(mfrow=c(1,2))\nwith(iris, boxplot(Sepal.Length))\nwith(iris, plot(Sepal.Length ~ Species))\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\n\n\n### Is One of these Groups not like the others? \n\nStatistically, this is asking whether the sums of squares is minimized by assuming there is only one group (one mean)? Or three groups?\n\nFor this plot we will add an index column (1 to number of observations), and use `ggplot2`, `dplyr`, and the pipe from `magrittr`\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrequire(dplyr)\nrequire(magrittr)\nrequire(ggplot2)\n\ndat <- cbind(iris, id = 1:length(iris$Species))\nyhat <- mean(iris$Sepal.Length)  # grand mean of Sepal Length\n\np <- dat %>% ggplot(aes( x = id, y = Sepal.Length, group=Species)) \n\nq <- p + geom_point( size=2) + \n  geom_hline( aes(yintercept = mean(iris$Sepal.Length)) ) + \n  geom_segment( data=dat, aes( x = id, y = Sepal.Length, xend = id, yend = yhat), color=\"red\", lty = 3)\n\nq  \n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\n\nWe added two new ggplot2 functions:  \n\n-   __geom_hline()__ which adds a horizontal line used for the grand mean. This is similar to base R `abline()`  \n-   __geom_segment()__ which plots line segments indicated by x,y start points and xend,yend end points (this is based on the base R `segment()` function)  \n\nTo add in the group structure, we need to compute means by species, and know where one species ends and the other begins in the data vector. We can do this with `group_by()` and `summarize()`:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nspmeans  <- dat %>% group_by(Species) %>% \n        summarise(\n          sl = mean(Sepal.Length),\n          n = length(Sepal.Length),\n          minid = min(id),\n          maxid = max(id)\n        )\n\nspmeans\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 3 × 5\n  Species       sl     n minid maxid\n  <fct>      <dbl> <int> <int> <int>\n1 setosa      5.01    50     1    50\n2 versicolor  5.94    50    51   100\n3 virginica   6.59    50   101   150\n```\n\n\n:::\n:::\n\n\n\n(You should always check that minid and maxid is what you intended)\n\nWe want to include this mean information in the dataframe, so to add it as a vector, we can `merge()`: \n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndat <- merge(dat, spmeans)\nhead(dat)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  Species Sepal.Length Sepal.Width Petal.Length Petal.Width id    sl  n minid\n1  setosa          5.1         3.5          1.4         0.2  1 5.006 50     1\n2  setosa          4.9         3.0          1.4         0.2  2 5.006 50     1\n3  setosa          4.7         3.2          1.3         0.2  3 5.006 50     1\n4  setosa          4.6         3.1          1.5         0.2  4 5.006 50     1\n5  setosa          5.0         3.6          1.4         0.2  5 5.006 50     1\n6  setosa          5.4         3.9          1.7         0.4  6 5.006 50     1\n  maxid\n1    50\n2    50\n3    50\n4    50\n5    50\n6    50\n```\n\n\n:::\n\n```{.r .cell-code}\ndat[45:55,]\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n      Species Sepal.Length Sepal.Width Petal.Length Petal.Width id    sl  n\n45     setosa          5.1         3.8          1.9         0.4 45 5.006 50\n46     setosa          4.8         3.0          1.4         0.3 46 5.006 50\n47     setosa          5.1         3.8          1.6         0.2 47 5.006 50\n48     setosa          4.6         3.2          1.4         0.2 48 5.006 50\n49     setosa          5.3         3.7          1.5         0.2 49 5.006 50\n50     setosa          5.0         3.3          1.4         0.2 50 5.006 50\n51 versicolor          7.0         3.2          4.7         1.4 51 5.936 50\n52 versicolor          6.4         3.2          4.5         1.5 52 5.936 50\n53 versicolor          6.9         3.1          4.9         1.5 53 5.936 50\n54 versicolor          5.5         2.3          4.0         1.3 54 5.936 50\n55 versicolor          6.5         2.8          4.6         1.5 55 5.936 50\n   minid maxid\n45     1    50\n46     1    50\n47     1    50\n48     1    50\n49     1    50\n50     1    50\n51    51   100\n52    51   100\n53    51   100\n54    51   100\n55    51   100\n```\n\n\n:::\n\n```{.r .cell-code}\ntail(dat)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n      Species Sepal.Length Sepal.Width Petal.Length Petal.Width  id    sl  n\n145 virginica          6.7         3.3          5.7         2.5 145 6.588 50\n146 virginica          6.7         3.0          5.2         2.3 146 6.588 50\n147 virginica          6.3         2.5          5.0         1.9 147 6.588 50\n148 virginica          6.5         3.0          5.2         2.0 148 6.588 50\n149 virginica          6.2         3.4          5.4         2.3 149 6.588 50\n150 virginica          5.9         3.0          5.1         1.8 150 6.588 50\n    minid maxid\n145   101   150\n146   101   150\n147   101   150\n148   101   150\n149   101   150\n150   101   150\n```\n\n\n:::\n:::\n\n\n\nNow that we have our dataframe with all of the necessary information, we can plot. \n\nNote that there are two calls to `geom_segment()`. For the first, we are plotting the species means, so we use the smmeans dataset. For the second, we are plotting each pointʻs deviation from the species means so we use the full dataset.  The rest is telling the function where the start and end points of each segment are:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nr <- p + geom_point( size=2) + \n  geom_segment( data=spmeans, aes(x=minid, y = sl, xend=maxid, yend=sl, group=Species )) + \n  geom_segment( data=dat, aes( x = id, y = Sepal.Length, xend = id, yend = sl, color=Species), lty = 3) \n\nr  \n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::\n\n\n\n\nBack to our question - is the error sum of squares minimized by accouting for separate species or considering all irises as one group? Another way to state ANOVA is - is at least one of these groups different than the others?\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrequire(cowplot)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nLoading required package: cowplot\n```\n\n\n:::\n\n```{.r .cell-code}\nplot_grid(\n  q, \n  r + theme(legend.position=\"none\"), \n  labels=\"AUTO\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n\n\nIf we want to know whether species are different in sepal length, then we need to have lm fit the model by species. We do this like so:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlm.fit <- with(iris, lm(Sepal.Length ~ Species))\nsummary(lm.fit)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nlm(formula = Sepal.Length ~ Species)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-1.6880 -0.3285 -0.0060  0.3120  1.3120 \n\nCoefficients:\n                  Estimate Std. Error t value Pr(>|t|)    \n(Intercept)         5.0060     0.0728  68.762  < 2e-16 ***\nSpeciesversicolor   0.9300     0.1030   9.033 8.77e-16 ***\nSpeciesvirginica    1.5820     0.1030  15.366  < 2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 0.5148 on 147 degrees of freedom\nMultiple R-squared:  0.6187,\tAdjusted R-squared:  0.6135 \nF-statistic: 119.3 on 2 and 147 DF,  p-value: < 2.2e-16\n```\n\n\n:::\n:::\n\n\n\n__Interpretation:__ One-way ANOVA is like fitting a regression of the individual points against the grand mean of the points vs. separate regressions for each group. The summary shows that the the intercept (the mean of setosa) is about 5 (significantly different than zero), whereas the other species are contrasts against setosa, the first species. Versicolor is 0.93 higher than setosa, and  virginica is 1.58 higher than setosa. Both of these contrasts are signficant. So they are actually all significantly different than each other\n\n\nNotice that now have more parameters estimated. You can specify which parameter values and contrasts you want displayed. Often we just want an ANOVA table, which tests the hypothesis that __at least one group is different than the others__:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nanova(lm.fit)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nAnalysis of Variance Table\n\nResponse: Sepal.Length\n           Df Sum Sq Mean Sq F value    Pr(>F)    \nSpecies     2 63.212  31.606  119.26 < 2.2e-16 ***\nResiduals 147 38.956   0.265                      \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n\n\n:::\n:::\n\n\n\nWe can see that species are significantly different in sepal length. Can you make a plot that shows this and add the statistics to it? \n\n_And thatʻs how ANOVA is related to regression!_ \n\n\n## ANCOVA\n\nThere are many forms of regession and ANOVA. For example, if you want to see if the relationship between Sepal.Length and Sepal.Width differs by species, you woul do an ANCOVA (analysis of covariance):\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlm.fit <- with(iris, lm(Sepal.Width ~ Sepal.Length + Species))\nsummary(lm.fit)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nlm(formula = Sepal.Width ~ Sepal.Length + Species)\n\nResiduals:\n     Min       1Q   Median       3Q      Max \n-0.95096 -0.16522  0.00171  0.18416  0.72918 \n\nCoefficients:\n                  Estimate Std. Error t value Pr(>|t|)    \n(Intercept)        1.67650    0.23536   7.123 4.46e-11 ***\nSepal.Length       0.34988    0.04630   7.557 4.19e-12 ***\nSpeciesversicolor -0.98339    0.07207 -13.644  < 2e-16 ***\nSpeciesvirginica  -1.00751    0.09331 -10.798  < 2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 0.289 on 146 degrees of freedom\nMultiple R-squared:  0.5693,\tAdjusted R-squared:  0.5604 \nF-statistic: 64.32 on 3 and 146 DF,  p-value: < 2.2e-16\n```\n\n\n:::\n:::\n\n\n\nWhich would fit separate Y-intercepts for each species. \n\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}